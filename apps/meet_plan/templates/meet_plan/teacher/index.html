{% extends 'index.html' %}
{% load staticfiles %}

{% block title %}
    综合指导课首页
{% endblock %}
{% block content-header %}
    <h1>综合指导课首页</h1>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-3">

            <!-- Profile Image -->
            <div class="box box-primary">
                <div class="box-body box-profile">
                    {% if user.baseprofile and user.baseprofile.user_img %}
                        <img class="profile-user-img img-responsive img-circle"
                             src="{{ user.baseprofile.user_img.url }}"
                             alt="User profile picture">
                    {% else %}
                        <img src="{% static 'images/headpicture/default.jpg' %}"
                             class="profile-user-img img-responsive img-circle" alt="User profile picture">
                    {% endif %}

                    <h3 class="profile-username text-center">{{ user.user_name }}</h3>

                    <p class="text-muted text-center"></p>

                    <ul class="list-group list-group-unbordered">
                        <li class="list-group-item">
                            <b>本学期安排数</b> <a class="pull-right">{{ this_term_plan.count }}</a>
                        </li>
                        <li class="list-group-item">
                            <b>本学期预约数</b> <a class="pull-right">{{ this_term_planorder_num }}</a>
                        </li>
                        <li class="list-group-item">
                            <b>历史安排数</b> <a class="pull-right">{{ history_plan_num }}</a>
                        </li>
                    </ul>

                    <a href="{% url 'meet_plan:tea-plan-add' %}" class="btn btn-primary btn-block"><b>新增安排</b></a>
                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->

            <!-- About Box -->
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">相关说明</h3>
                </div>
                <!-- /.box-header -->
                <div class="box-body">

                    <strong><i class="fa fa-file-text-o margin-r-5"></i> 使用流程</strong>
                    <ul>
                        <li>添加时间安排</li>
                        <li>如有同学选择了您的预约谈话，您将收到电子邮件通知，您也可以在本页面右侧看到具体的预约TimeLine</li>
                        <li>和学生谈话完成后，请再次及时登录系统“确认”与相应同学的谈话</li>
                    </ul>

                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->
        </div>
        <!-- /.col -->
        <div class="col-md-9">
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#timeline_after" data-toggle="tab">时间线</a></li>
                    <li><a href="#timeline_before" data-toggle="tab">之前的安排</a></li>
                    <li><a href="#this_term_plan" data-toggle="tab">本学期安排</a></li>
                    <li><a href="#about" data-toggle="tab">补充说明</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="timeline_after">
                        <!-- The timeline -->
                        <ul class="timeline timeline-inverse">
                            {% for meetplan in this_term_plan_after_now %}
                                <!-- timeline time label -->
                                <li class="time-label">
                                <span class="bg-red">
                                  {{ meetplan.start_time|date:'m月d日' }}
                                </span>
                                    <span class="bg-blue">
                                    {{ meetplan.start_time|time }}到{{ meetplan.end_time|time }}
                                </span>
                                </li>
                                <!-- /.timeline-label -->
                                {% for order in meetplan.meetplanorder_set.all %}
                                    <!-- timeline item -->
                                    <li>
                                        <i class="fa fa-comments bg-yellow"></i>

                                        <div class="timeline-item">
                                            <span class="time"><i
                                                    class="fa fa-clock-o"></i>于{{ order.create_time }}预约</span>

                                            <h3 class="timeline-header"><a href="#">{{ order.student.user_name }}</a>
                                            </h3>

                                            <div class="timeline-body">
                                                {{ order.message }}
                                            </div>
                                            <div class="timeline-footer">
                                                <a class="btn btn-warning btn-flat btn-xs">待进行</a>
                                            </div>
                                        </div>
                                    </li>
                                    <!-- END timeline item -->
                                {% endfor %}
                            {% endfor %}
                            <li>
                                <i class="fa fa-clock-o bg-gray"></i>
                            </li>
                        </ul>
                    </div>

                    <div class="tab-pane" id="timeline_before">
                        <!-- The timeline -->
                        <ul class="timeline timeline-inverse">
                            {% for meetplan in this_term_plan_before_now %}
                                {% if meetplan.meetplanorder_set.exists %}
                                    <!-- timeline time label -->
                                    <li class="time-label">
                                <span class="bg-red">
                                  {{ meetplan.start_time|date:'m月d日' }}
                                </span>
                                        <span class="bg-blue">
                                    {{ meetplan.start_time|time }}到{{ meetplan.end_time|time }}
                                </span>
                                    </li>
                                    <!-- /.timeline-label -->
                                    {% for order in meetplan.meetplanorder_set.all %}
                                        <!-- timeline item -->
                                        <li>
                                            <i class="fa fa-comments bg-yellow"></i>

                                            <div class="timeline-item">
                                            <span class="time"><i
                                                    class="fa fa-clock-o"></i>于{{ order.create_time }}预约</span>

                                                <h3 class="timeline-header"><a
                                                        href="#">{{ order.student.user_name }}</a>
                                                </h3>

                                                <div class="timeline-body">
                                                    {{ order.message }}
                                                </div>
                                                <div class="timeline-footer">
                                                    {% if order.completed %}
                                                        <a class="btn btn-success btn-flat btn-xs">已确认</a>
                                                    {% else %}
                                                        <a class="btn btn-warning btn-flat btn-xs"
                                                           href="{% url 'meet_plan:tea-order-update' order.id %}">去确认</a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </li>
                                        <!-- END timeline item -->
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                            <li>
                                <i class="fa fa-clock-o bg-gray"></i>
                            </li>
                        </ul>
                    </div>
                    <div class="tab-pane" id="this_term_plan">
                        <div class="box">
                            <div class="box-header">
                                <h3 class="box-title">本学期({{ term_start_date }}到{{ term_end_date }})预约记录</h3>
                            </div>
                            <!-- /.box-header -->

                            {% for meetplan in this_term_plan %}
                                {% if forloop.first %}
                                    <div class="box-body table-responsive no-padding">
                                    <table class="table table-hover">
                                    <tbody>
                                    <tr>
                                        <th>计划编号</th>
                                        <th>地点</th>
                                        <th>日期</th>
                                        <th>时间</th>
                                        <th>是否允许多人</th>
                                        <th>操作</th>
                                    </tr>
                                {% endif %}
                            <tr>
                                <td>{{ meetplan.id }}</td>
                                <td>{{ meetplan.place }}</td>
                                <td>{{ meetplan.start_time|date }}</td>
                                <td>{{ meetplan.start_time|time }}到{{ meetplan.end_time|time }}</td>
                                <td>
                                    {% if meetplan.allow_other %}
                                        允许
                                    {% else %}
                                        不允许
                                    {% endif %}
                                </td>
                                <td><a href="{% url 'meet_plan:tea-plan-detail' meetplan.id %}">查看详情</a></td>
                            </tr>
                            {% if forloop.last %}
                                </tbody>
                                </table>
                                </div>
                                <!-- /.box-body -->
                            {% endif %}
                            {% empty %}
                                <div class="box-body table-responsive no-padding">
                                    暂无任何安排
                                </div>
                            {% endfor %}
                        </div>
                        <!-- /.box -->
                    </div>
                    <div class="tab-pane" id="about">
                        <div class="box box-primary">
                            <div class="box-header with-border">
                                <h3 class="box-title">补充说明</h3>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <strong><i class="fa fa-file-text-o margin-r-5"></i>有同学参与了谈话，但没有经过网上预约，如果添加记录？</strong>
                                <ul>
                                    <li>记录同学姓名、日期、时间、地点</li>
                                    <li>登录选课系统，使用“使用反馈”功能，提交以上信息</li>
                                    <li>或者发Email给管理员，注明添加选课指导谈话记录</li>
                                </ul>
                                <hr/>
                                <strong><i class="fa fa-file-text-o margin-r-5"></i>误删了同学记录怎么办？</strong>
                                <ul>
                                    <li>找到同学预约时收到的Email，复制内容</li>
                                    <li>如果找不到预约Email，记录同学姓名、日期、时间、地点</li>
                                    <li>登录选课系统，点击“使用反馈”链接，注明找回记录，粘贴以上信息提交</li>
                                </ul>
                            </div>
                            <!-- /.box-body -->
                        </div>
                        <!-- /.box -->
                    </div>
                    <!-- /.tab-pane -->
                </div>
                <!-- /.tab-content -->
            </div>
            <!-- /.nav-tabs-custom -->
        </div>
        <!-- /.col -->
    </div>
{% endblock %}