// Code generated by hertz generator.

package main

import (
	"github.com/cloudwego/hertz/pkg/app/server"
	"github.com/hertz-contrib/cors"
	"github.com/hertz-contrib/logger/accesslog"
	"github.com/hertz-contrib/pprof"
	"github.com/hertz-contrib/requestid"

	"meetplan/internal/oidc_rp"

	"meetplan/biz/dal"
	"meetplan/biz/dal/mysql"
	"meetplan/biz/gorm_gen/query"
	"meetplan/config"
)

func main() {
	dal.Init()
	query.SetDefault(mysql.DB)
	oidc_rp.GetProvider()

	conf := config.GetConf()
	h := server.Default(server.WithHostPorts(conf.Hertz.Address))
	if conf.Hertz.EnablePprof {
		pprof.Register(h)
	}
	h.Use(accesslog.New(), cors.Default(), requestid.New())
	register(h)

	h.Spin()
	dal.Close()
}
